<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<title>校园网登录器</title>

	<script>
		function login_init() {
			// usrename_encrypt
			var username_crypto = "";
			var username = document.getElementById("username").value;
			for (var i = 0; i < username.length; ++i) {
				username_crypto += String.fromCharCode(username.charCodeAt(i) + 4);
			}
			document.getElementById("real_username").value = "{SRUN3}\r\n" + username_crypto;

			// password_encrypt
			var key = "1234567890";
			var password = document.getElementById("password").value;
			var password_crypto = "";
			for (var i = 0; i < password.length; ++i) {
				var ki = password.charCodeAt(i) ^ key.charCodeAt(key.length - i % key.length - 1);
				var _l = String.fromCharCode((ki & 0x0f) + 0x36);
				var _h = String.fromCharCode((ki >> 4 & 0x0f) + 0x63);
				if (i % 2 == 0) {
					password_crypto += _l + _h;
				} else {
					password_crypto += _h + _l;
				}
			}
			document.getElementById("real_password").value = password_crypto;
		}

		function logout_init() {
			document.getElementById("logout_ac_id").value = document.getElementById("login_ac_id").value;
		}

		function openurl(url) {
			window.location.href = url;
		}
	</script>
</head>

<body>
	<div class="container">
		<form action="http://172.16.154.130:69/cgi-bin/srun_portal" method="POST" onsubmit="login_init()">
			<h2>Login</h2>
			<input type="hidden" name="action" value="login" /> username:
			<input id="username" /><br />
			<input type="hidden" id="real_username" name="username" /> password:
			<input id="password" type="password" /><br />
			<input type="hidden" id="real_password" name="password" />
			<input type="hidden" name="drop" value="0" />
			<input type="hidden" name="pop" value="1" />
			<input type="hidden" name="type" value="2" />
			<input type="hidden" name="n" value="117" />
			<input type="hidden" name="mbytes" value="0" />
			<input type="hidden" name="minutes" value="0" /> ac_id:
			<input type="text" name="ac_id" value="1" id="login_ac_id" /><br />
			If respond <i>"login_error#INFO failed, BAS respond timeout."</i>, change your value of <b>ac_id</b> and try again. Generally, the value should be <b>1</b> or <b>2</b>.<br />
			<input type="submit" class="btn btn-primary" value="Login" />
		</form>

		<!-- 注销 -->
		<form action="http://172.16.154.130:69/cgi-bin/srun_portal" method="POST" onsubmit="logout_init()">
			<input type="hidden" name="type" value="2" />
			<input type="hidden" name="username" value="logout" />
			<input type="hidden" name="action" value="logout" />
			<input type="hidden" name="ac_id" id="logout_ac_id" />
			<input type="hidden" name="mac" />
			<input type="submit" class="btn btn-primary" value="Logout" />
		</form>
		<hr />

		<!-- 管理功能 -->
		<h2>Manage</h2>
		<button onclick="openurl('http://172.16.154.130/cgi-bin/rad_user_info')">Current Status</button>
		<button onclick="openurl('http://172.16.154.130:8800/')">Account Settings</button>
		<hr />

		<!-- 获取广播信息 -->
		<h2>Broadcast Message</h2>
		<iframe id="broadcast_frame" src="http://172.16.154.130/get_msg.php"></iframe>
	</div>

	<br /><br />
	<div id="page-footer">
		<footer>
			<small>&copy; Authored by <a href="https://github.com/samuelts/srun3k-client/">Samuelts</a></small>
		</footer>
	</div>
</body>

</html>
